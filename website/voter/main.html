<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Vote</title>
  
    <meta charset="UTF-8">
  <title>Voter Page</title>
  <link rel="stylesheet" href="./style.css">
  <script src="https://cdn.jsdelivr.net/npm/web3@latest/dist/web3.min.js"></script>
  <style>
    
  </style>
</head onload = "loadWeb3();">
<body>
  <nav>
    <h2>Voter Portal</h2>
    <button onclick="window.location.href='..\\Results\\main.html'">Go To Results.</button>
  </nav>

  <h1>Select Your Candidate</h1>

  <form id="voteForm">
    <div class="candidate-options" id="candidatesDiv"></div>
    <button type="submit">Submit Vote</button>
  </form>
  <script src = "web3_voting.js"></script>
  <script src = "script.js"></script>
  <script type="module">
    // Map of candidates to vote counts
    const candidateMap = await getAllCandidates();

    const candidatesDiv = document.getElementById("candidatesDiv");
    const defaultImg = "OIP.png";

    // Render candidate cards
    candidateMap.forEach((_, name) => {
      const label = document.createElement("label");
      label.className = "candidate";

      const img = document.createElement("img");
      img.src = defaultImg;
      img.alt = name;

      const nameEl = document.createElement("h3");
      nameEl.textContent = name;

      const radio = document.createElement("input");
      radio.type = "radio";
      radio.name = "candidate";
      radio.value = name;

      label.appendChild(img);
      label.appendChild(nameEl);
      label.appendChild(radio);

      candidatesDiv.appendChild(label);
    });

    document.getElementById("voteForm").addEventListener("submit", function (event) {
      event.preventDefault();
      const selected = document.querySelector('input[name="candidate"]:checked');
      if (selected) {
        const candidate = selected.value;
        candidateMap.set(candidate, candidateMap.get(candidate) + 1);
        
        var i = 0;
        for (const[key,value] of candidateMap){
            if (key == candidate){
                vote(i);
            }
            i = i+1;
        }
        alert("You voted for: " + candidate + "\nTotal votes for " + candidate + ": " + candidateMap.get(candidate));
        window.location.href='..\\Results\\main.html';
      } else {
        alert("Please select a candidate before submitting.");
      }
    });

    function goToResults() {
      alert("You will be redirected to the results page (functionality not implemented).");
      // Example: window.location.href = "results.html";
    }
  </script>
  
  
</body>
</html>
